# python并发编程介绍

## 并发，并行编程

* 并发，在同一个处理机(单CPU上），一个时间段中有几个程序都处于已启动运行到运行完毕之间，并发是一次处理很多事情，但任一个时刻点上只有一个程序在处理机上运行。

* 并行，当系统多个CPU时,一个CPU执行一个线程时，另一个CPU可以执行另一个线程，两个线程互不抢占CPU资源，**可以同时进行**，这种方式我们称之为并行(Parallel)。并行不一定并发。并行也有同步和异步，异步往往能提升效率。

  总结:

  CPU同一时刻只能调度一个进程，所有单核的CPU同一时间只能做到伪并发，因为几个程序会来回切换，比如遇到I/O，阻塞等情况下就切换，只是人感受不到。**而并行可以是利用多核的CPU进行的任务。**

  在python中由于有GIL锁的存在，一个CPU只能同时运行一个线程，其他核的CPU是挂起状态，是一种伪并发机制。不过并不意味着python的并发编程就慢，选择合适的方法可以提高效率。比如多进程（可以多核运行）适合用在CPU密集型的任务，多线程在I/O密集的任务中，也发挥很大的作用。

  

## 介绍python的线程和进程和协程

先来看一张图，简单表示进程，线程和协程的大概状态。一个进程可以有多个线程，协程是基于线程，是在应用层模拟的线程，他避免了上下文切换的额外耗费，兼顾了多线程的优点。简化了高并发程序的复杂度。

![进程线程协程](\img\进程线程协程.jpg)

多进程支持：python使用multiprocessing模块来开发多进程，主要用于计算密集型人物，比如需要用到CPU运算多的任务。

多线程支持：目前的多线程开发我们推荐使用threading模块，在Python早期的版本中就引入了thread模块（现在名为_thread）来实现多线程编程，现在推荐使用的就是threading模块。

协程：近些年才支持的，线程的切换是在内核调度，而协程是由用户自行调度，切换更快，桟更小。目前用在异步编程多一些。同样是提升效率。

## 进程和线程协程该怎么选

上面说过，多进程一般用在CPU密集型任务，线程一般用在I/O密集型任务中。下面看一下python中线程的执行示例图。

![](\img\164431n4zkzuz34ua30ow4.jpg)

遇到I/O请求，会释放当前线程，而调度其他线程执行。如此循环，直到结束。协程比线程开销小得多，一个进程内可以同时存在多个协程，但是只有一个协程是激活的，而且协程的激活和休眠时程序员通过编程来控制。比如python的yield就实现协程，还有异步的回调，用在异步编程比较多。